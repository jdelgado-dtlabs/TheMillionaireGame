<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <title>Who Wants to be a Millionaire - Audience Participation</title>
    
    <!-- Mobile Web App Meta Tags (ephemeral session only) -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Millionaire">
    <meta name="theme-color" content="#FFD700">
    
    <!-- Privacy & Security Meta Tags -->
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="referrer" content="no-referrer">
    
    <!-- Explicitly prevent PWA installation (ephemeral by design) -->
    <!-- NO manifest link - prevents 'Add to Home Screen' prompts -->
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <!-- Application Styles -->
    <link rel="stylesheet" href="/css/app.css">
</head>
<body>
    <div class="container">
        <h1>
            <img src="logo.png" alt="Logo" class="logo">
            Millionaire Game Audience
        </h1>
        
        <!-- Connection Status Overlay -->
        <div id="connectionOverlay" class="connection-overlay" style="display: none;">
            <div class="connection-overlay-content">
                <div class="spinner"></div>
                <h2 id="connectionOverlayTitle">Lost Connection</h2>
                <p id="connectionOverlayMessage">Retrying...</p>
            </div>
        </div>
        
        <!-- Debug Panel (Mobile only) -->
        <div id="debugPanel" style="display: none; position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.9); color: #0f0; padding: 10px; border: 1px solid #0f0; font-family: monospace; font-size: 10px; z-index: 9999; max-width: 300px; border-radius: 5px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                <strong style="color: #0ff;">DEBUG INFO</strong>
                <button id="closeDebug" style="background: #f00; color: #fff; border: none; padding: 2px 8px; cursor: pointer; border-radius: 3px;">✕</button>
            </div>
            <div id="debugContent" style="line-height: 1.4;"></div>
        </div>
        
        <!-- Join Screen -->
        <div id="joinScreen" class="screen active">
            <div class="status disconnected">Not Connected</div>
            <div id="errorMessage" class="error-message" style="display: none;"></div>
            <input type="text" id="txtDisplayName" placeholder="Enter your name" maxlength="35" />
            <input type="text" id="sessionCode" placeholder="Session code (or from URL)" style="display: none;" />
            
            <div class="info">
                <strong>&#x2728; Name Requirements:</strong><br>
                • 1-35 characters<br>
                • No emojis or special symbols<br>
                • No inappropriate language<br>
                • Must be unique in the session
            </div>
            
            <div class="privacy-notice">
                <strong>&#x1F512; Privacy Notice:</strong><br>
                We collect anonymous usage data (device type, OS version, browser, play duration) for statistics. 
                Your name and all identifying information are deleted after the show. By clicking "Join Session", 
                you agree to these terms.
            </div>
            
            <button id="btnJoin">Join Session</button>
        </div>
        
        <!-- Connected Screen -->
        <!-- TODO: Differentiate lobby states
             Current: Pre-game testing screen (fine for before game starts)
             Needed: When game starts (Host Intro clicked on control panel), show:
             "Welcome to Who Wants to be a Millionaire! The show has begun!"
             with no buttons (waiting for host to select FFF players)
        -->
        <div id="connectedScreen" class="screen">
            <div class="status connected">&#x2713; Connected to Session</div>
            
            <div class="info">
                <strong>Session:</strong> <span id="displaySessionId"></span><br>
                <strong>Your Name:</strong> <span id="lblDisplayName"></span><br>
                <strong>Participant ID:</strong> <span id="displayParticipantId"></span><br>
                <strong>Connection ID:</strong> <span id="displayConnectionId"></span>
            </div>
            
            <button id="btnTestReconnect">&#x1F504; Test Reconnect (Disconnect & Reconnect)</button>
            <button id="btnLeave">Leave Session</button>
            
            <div class="info" style="margin-top: 20px; background: rgba(0, 255, 0, 0.1);">
                <strong>&#x2713; Protected Features:</strong><br>
                • Your participant ID is saved in localStorage<br>
                • If you refresh or disconnect, you'll reconnect with the same ID<br>
                • Duplicate votes/answers are prevented server-side<br>
                • Your progress in FFF is maintained
            </div>
        </div>
        
        <!-- FFF Question Screen -->
        <div id="fffQuestionScreen" class="screen">
            <div class="status connected">&#x26A1; Fastest Finger First</div>
            
            <h2 id="fffQuestionText" style="color: #FFD700; margin: 20px 0; font-size: 1.3em;"></h2>
            
            <div id="fffTimer" class="timer">
                <span id="fffTimerSeconds">20</span>s
            </div>
            
            <div id="fffAnswerList" class="fff-answer-list">
                <!-- Answer items will be dynamically added here -->
            </div>
            
            <button id="btnSubmitFFF" class="submit-button">Submit Answer</button>
            
            <div id="fffMessage" class="info" style="display: none; margin-top: 20px;"></div>
        </div>
        
        <!-- FFF Waiting Screen -->
        <div id="fffWaitingScreen" class="screen">
            <div class="status connected">&#x26A1; Fastest Finger First</div>
            
            <h2 id="fffWaitingMessage" style="color: #FFD700; margin: 40px 20px; font-size: 1.4em; text-align: center;">
                Results are being calculated.<br>
                Please Stand By.<br>
                The Host will announce the winners shortly.
            </h2>
        </div>
        
        <!-- FFF Result Screen -->
        <div id="fffResultScreen" class="screen">
            <div class="status connected">&#x26A1; Results</div>
            
            <h2 id="fffResultMessage" style="color: #FFD700; margin: 40px 20px; font-size: 1.4em; text-align: center;"></h2>
        </div>

        <!-- ATA Voting Screen -->
        <div id="ataVotingScreen" class="screen">
            <div class="status connected">&#x1F4CA; Ask The Audience</div>
            
            <h2 id="ataQuestionText" style="color: #FFD700; margin: 20px 0;"></h2>
            
            <div id="ataTimer" class="timer">
                <span id="timerSeconds">30</span>s
            </div>
            
            <div id="ataVoteButtons" style="margin: 20px 0;">
                <button id="btnVoteA" class="vote-button" data-option="A">
                    <strong>A:</strong> <span id="optionAText"></span>
                </button>
                <button id="btnVoteB" class="vote-button" data-option="B">
                    <strong>B:</strong> <span id="optionBText"></span>
                </button>
                <button id="btnVoteC" class="vote-button" data-option="C">
                    <strong>C:</strong> <span id="optionCText"></span>
                </button>
                <button id="btnVoteD" class="vote-button" data-option="D">
                    <strong>D:</strong> <span id="optionDText"></span>
                </button>
            </div>
            
            <div id="ataMessage" class="info" style="display: none;"></div>
            
            <div id="ataResults" style="margin-top: 30px; display: none;">
                <h3 style="color: #FFD700;">Results:</h3>
                <div class="results-bar">
                    <div class="results-fill" id="resultsFillA" style="width: 0%;"></div>
                    <div class="results-text" id="resultsTextA">A: 0%</div>
                </div>
                <div class="results-bar">
                    <div class="results-fill" id="resultsFillB" style="width: 0%;"></div>
                    <div class="results-text" id="resultsTextB">B: 0%</div>
                </div>
                <div class="results-bar">
                    <div class="results-fill" id="resultsFillC" style="width: 0%;"></div>
                    <div class="results-text" id="resultsTextC">C: 0%</div>
                </div>
                <div class="results-bar">
                    <div class="results-fill" id="resultsFillD" style="width: 0%;"></div>
                    <div class="results-text" id="resultsTextD">D: 0%</div>
                </div>
                <p id="totalVotes" style="text-align: center; color: #FFD700; margin-top: 10px;">Total votes: 0</p>
            </div>
        </div>
    </div>

    <!-- Third-Party Libraries -->
    <!-- Load SignalR library - Local first for reliability on isolated networks -->
    <!-- Local file ensures offline/degraded network compatibility -->
    <script src="/lib/signalr/signalr.min.js"></script>
    
    <!-- Application Script with cache busting -->
    <script>
        document.write('<script src="/js/app.js?v=' + Date.now() + '"><\/script>');
    </script>

</body>
</html>
